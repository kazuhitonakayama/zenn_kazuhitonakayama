---
title: "Rubyã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã®æ™‚ã“ã“ã«æ°—ã‚’ã¤ã‘ã‚ã‚·ãƒªãƒ¼ã‚ºï¼šPsych::BadAlias Unknown alias: defaultã®ã‚¨ãƒ©ãƒ¼ã®åŸå› ã¨ãã®å¯¾å¿œ"
emoji: "ğŸ›"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [rails, ruby, psych, yaml]
published: true
---

## å‰æ
- Rubyï¼š3.0.0
- railsï¼š6.1.3.1

## çµŒç·¯
Rubyã‚’3.0.0ã‹ã‚‰3.1ã«ä¸Šã’ãŸã¨ã“ã‚ã€railsã‚¢ãƒ—ãƒªç«‹ã¡ä¸Šã’æ™‚ã«ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸã€‚

```shell
/usr/local/bundle/gems/psych-3.3.0/lib/psych/visitors/to_ruby.rb:420:in `resolve_class': Unknown alias: default (Psych::BadAlias)
```

## åŸå› 
Ruby3.1ã‹ã‚‰æ–°ãŸã«Psychã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒ4.0ã«ä¸ŠãŒã‚Šã€`Psych.load` ãŒ `safe_load` ã‚’åˆ©ç”¨ã™ã‚‹ã‚ˆã†ã«ãªã£ãŸã€‚

> Psych 4.0 ã§ã¯ Psych.load ãŒ safe_load ã‚’åˆ©ç”¨ã™ã‚‹ã‚ˆã†ã«å¤‰æ›´ã•ã‚Œã¾ã—ãŸã€‚ã“ã®æŒ™å‹•ãŒå½±éŸ¿ã‚ã‚‹å ´åˆã¯ã€å¾“æ¥ã®æŒ™å‹•ã§ã‚ã‚‹ unsafe_load ã‚’åˆ©ç”¨ã™ã‚‹ Psych 3.3.2 ã‚’ç§»è¡Œãƒ‘ã‚¹ã¨ã—ã¦åˆ©ç”¨ã§ãã¾ã™ã€‚[Bug #17866]

ref: https://www.ruby-lang.org/ja/news/2021/12/25/ruby-3-1-0-released/

ã“ã®å¤‰æ›´ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªèƒŒæ™¯ãŒã‚ã‚‹ã‚‰ã—ã„ã€‚

> loadãƒ¡ã‚½ãƒƒãƒ‰ãŒæ­£ã—ãä½¿ã‚ã‚Œãªã„ã¨è„†å¼±ã«ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã®ã§ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§safe_loadã‚’å®Ÿè¡Œã™ã‚‹ã‚ˆã†ã«

ref: https://techracho.bpsinc.jp/hachi8833/2021_05_18/107813#3-3

## å¯¾å¿œ
Rails6.1.4ã«ã¦ã€ã“ã®Psych4.0ã¸ã®äº’æ›æ€§ã®å¯¾å¿œãŒè¡Œã‚ã‚ŒãŸã®ã§ã€railsã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’`6.1.3.1`ã‹ã‚‰`6.1.4`ã«ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ã—ãŸã€‚

> Starting in Psych 4.0.0 YAML.load behaves like YAML.safe_load. To preserve compatibility `Rails.application.config_for` now uses `YAML.unsafe_load` if available.

ref: https://github.com/rails/rails/releases/tag/v6.1.4

å¯¾å¿œã¨ã—ã¦ã¯ã€`sale_load` ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«ãªã£ãŸãŸã‚ã«ã€åˆ¶ç´„ãŒå³ã—ããªã‚‹ã®ã§ã€å¯èƒ½ãªç®‡æ‰€ã§ã¯ `unsafe_load` ã‚’ä½¿ã†ã‚ˆã†ã«ãªã£ãŸã¨ã„ã†ã“ã¨ã€‚

ã‚ã‚‹ã„ã¯ã“ã®è¨˜äº‹([visit_Psych_Nodes_Alias': Unknown alias: default (Psych::BadAlias)ã€€è§£æ±ºæ–¹æ³•](https://qiita.com/mono_glyceride/items/a447f2451078e8031cbc))ã§è¨€ã‚ã‚Œã¦ã„ã‚‹ã‚ˆã†ã«ã€Psychã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä¸‹ã’ã‚‹ã“ã¨ã§ã‚‚å¯¾å¿œã§ãã‚‹ã‚‰ã—ã„ã€‚
